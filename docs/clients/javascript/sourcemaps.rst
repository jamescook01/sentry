.. _sourcemaps:

Source Maps
===========

In various browsers Sentry supports deminifying JavaScript via source
maps. A source map is a file generated by your minifier which compresses a
mapping of the minified file to the original uncompressed version(s).

One important thing to note is that even though we support mapping files,
a users browser may not actually be able to collect the required
information for the server to generate a sourcemap.

Sentry requires the following to be able to map tracebacks to their
source:

*   A source map header or footer
*   A publicly accessible uncompressed version of the source
*   A line of context that includes a line number, column number, and filename

The first two items are the responsibility of you, the end-user, and you
can take care of publishing them as part of your build process. The latter
however, with an individual line of context, is severely crippled in many
browsers.

One thing to note is that Sentry will attempt to process the source map
before storing (or grouping) an event. This ensures that if we are able to
deminify the source, we'll be able to more effectively group similar
events over time.

Browser Support
---------------

In our experiences, the only browser that routinely delivers usable error
reports is Google Chrome.

For additional information, see this more up-to-date wiki page.

Generating a Source Map
-----------------------

While there are several compression libraries which support source maps,
as of writing our recommendation is to use UglifyJS.

As an example, we can look at the Sentry source code to see how we
generate internal source maps::

    node_modules/uglify-js/bin/uglifyjs {input}
        --source-map-root={relroot}/
        --source-map-url={name}.map.js
        --source-map={relpath}/{name}.map.js -o {output}

We won't attempt to go into the complexities of source maps, so we
recommend taking a stab at compiling them, and running them against a
validator.

Validating a Source Map
-----------------------

A third party tool is available to validate your source map:
http://sourcemap-validator.herokuapp.com/

Source Map Fetching
-------------------

.. sentry:edition:: cloud

    Source maps are dynamically fetched "in reverse".  If you are using
    Sentry Cloud then you might want to restrict the access to those
    sourcemaps by IP address.  For the IP ranges used by Sentry Cloud and
    how to whitelist access please refer to :doc:`../../cloud/ip-ranges`.
